/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */
import{Pose as e}from"@mediapipe/pose";import{Tensor as t,browser as n}from"@tensorflow/tfjs-core";var i=function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function o(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{u(i.next(e))}catch(e){r(e)}}function s(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((i=i.apply(e,t||[])).next())}))}function r(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}var a=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],s={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},u=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function l(e){return e instanceof SVGAnimatedLength?e.baseVal.value:e}function c(e){return o(this,void 0,void 0,(function(){var i,o;return r(this,(function(r){switch(r.label){case 0:return i=document.createElement("canvas"),e instanceof t?[4,n.toPixels(e,i)]:[3,2];case 1:return r.sent(),[3,3];case 2:i.width=l(e.width),i.height=l(e.height),o=i.getContext("2d"),e instanceof ImageData?o.putImageData(e,0,0):o.drawImage(e,0,0),r.label=3;case 3:return[2,i]}}))}))}function h(e){return o(this,void 0,void 0,(function(){var i,o,a,s,u,c;return r(this,(function(r){switch(r.label){case 0:return e instanceof t?(i=e.shape.slice(0,2),o=i[0],a=i[1],s=ImageData.bind,[4,n.toPixels(e)]):[3,2];case 1:return[2,new(s.apply(ImageData,[void 0,r.sent(),a,o]))];case 2:return u=document.createElement("canvas"),c=u.getContext("2d"),u.width=l(e.width),u.height=l(e.height),c.drawImage(e,0,0),[2,c.getImageData(0,0,u.width,u.height)]}}))}))}function f(e){return o(this,void 0,void 0,(function(){var t,i;return r(this,(function(o){switch(o.label){case 0:return e instanceof SVGImageElement||e instanceof OffscreenCanvas?[4,c(e)]:[3,2];case 1:return i=o.sent(),[3,3];case 2:i=e,o.label=3;case 3:return t=i,[2,n.fromPixels(t,4)]}}))}))}var p={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"};var m=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){return[2,this.mask]}))}))},e.prototype.toImageData=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){return[2,h(this.mask)]}))}))},e.prototype.toTensor=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){return[2,f(this.mask)]}))}))},e.prototype.getUnderlyingType=function(){return"canvasimagesource"},e}();function d(e){return function(e){if(e<0||e>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(e));if(!Number.isInteger(e))throw new Error("Mask value must be an integer but got ".concat(e))}(e),"person"}var g,y,v=function(){function i(t){var n,i=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new e({locateFile:function(e,n){if(t.solutionPath){var i=t.solutionPath.replace(/\/+$/,"");return"".concat(i,"/").concat(e)}return"".concat(n,"/").concat(e)}}),t.modelType){case"lite":n=0;break;case"heavy":n=2;break;case"full":default:n=1}this.poseSolution.setOptions({modelComplexity:n,smoothLandmarks:t.enableSmoothing,enableSegmentation:t.enableSegmentation,smoothSegmentation:t.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(e){if(i.height=e.image.height,i.width=e.image.width,null==e.poseLandmarks)i.poses=[];else{var t=i.translateOutput(e.poseLandmarks,e.poseWorldLandmarks);e.segmentationMask&&(t.segmentation={maskValueToLabel:d,mask:new m(e.segmentationMask)}),i.poses=[t]}}))}return i.prototype.translateOutput=function(e,t){var n=this,i={keypoints:e.map((function(e,t){return{x:e.x*n.width,y:e.y*n.height,z:e.z,score:e.visibility,name:a[t]}}))};return null!=t&&(i.keypoints3D=t.map((function(e,t){return{x:e.x,y:e.y,z:e.z,score:e.visibility,name:a[t]}}))),i},i.prototype.estimatePoses=function(e,i,a){return o(this,void 0,void 0,(function(){var o,s;return r(this,(function(r){switch(r.label){case 0:return i&&i.flipHorizontal&&i.flipHorizontal!==this.selfieMode&&(this.selfieMode=i.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof t?(s=ImageData.bind,[4,n.toPixels(e)]):[3,2];case 1:return o=new(s.apply(ImageData,[void 0,r.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:o=e,r.label=3;case 3:return e=o,[4,this.poseSolution.send({image:e},a)];case 4:return r.sent(),[2,this.poses]}}))}))},i.prototype.dispose=function(){this.poseSolution.close()},i.prototype.reset=function(){this.poseSolution.reset()},i.prototype.initialize=function(){return this.poseSolution.initialize()},i}();function b(e){return o(this,void 0,void 0,(function(){var t,n;return r(this,(function(o){switch(o.label){case 0:return t=function(e){if(null==e)return i({},p);var t=i({},e);return t.runtime="mediapipe",null==t.enableSegmentation&&(t.enableSegmentation=p.enableSegmentation),null==t.enableSmoothing&&(t.enableSmoothing=p.enableSmoothing),null==t.smoothSegmentation&&(t.smoothSegmentation=p.smoothSegmentation),null==t.modelType&&(t.modelType=p.modelType),t}(e),[4,(n=new v(t)).initialize()];case 1:return o.sent(),[2,n]}}))}))}function w(e,t){return o(this,void 0,void 0,(function(){var e,n;return r(this,(function(i){if(null!=(e=t)){if("mediapipe"===e.runtime)return[2,b(t)];n=e.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(n))}))}))}!function(e){e.MoveNet="MoveNet",e.BlazePose="BlazePose",e.PoseNet="PoseNet"}(g||(g={})),function(e){e.Keypoint="keypoint",e.BoundingBox="boundingBox"}(y||(y={}));var _=Object.freeze({__proto__:null,getKeypointIndexBySide:function(e){return s},getAdjacentPairs:function(e){return u},getKeypointIndexByName:function(e){return a.reduce((function(e,t,n){return e[t]=n,e}),{})}});var S={keypointsToNormalizedKeypoints:function(e,t){return e.map((function(e){var n=i(i({},e),{x:e.x/t.width,y:e.y/t.height});return null!=e.z&&(e.z=e.z/t.width),n}))}};export{g as SupportedModels,y as TrackerType,S as calculators,w as createDetector,_ as util};
